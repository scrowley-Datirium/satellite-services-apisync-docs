<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>server documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">server documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li>Injectables</li>
  <li >SamplesService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/mongoConnection/samples.service.ts</code>
        </p>





            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#checkSRRVariations" >checkSRRVariations</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#checkUpstreamOutputs" >checkUpstreamOutputs</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#clearVisualPlugins" >clearVisualPlugins</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getById" >getById</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#objectIsDirectory" >objectIsDirectory</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#objectIsFile" >objectIsFile</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateFileLocation" >updateFileLocation</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateInputClass" >updateInputClass</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#updateLocationsToRelative" >updateLocationsToRelative</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#updateOne" >updateOne</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateOutputs" >updateOutputs</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updatePreview" >updatePreview</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateProgress" >updateProgress</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateStatistics" >updateStatistics</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(sampleModel: <a href="../classes/Sample.html" target="_self">Model&lt;SampleDocument&gt;</a>, tasksQueueService: <a href="../injectables/TasksQueueService.html" target="_self">TasksQueueService</a>, cwlService: <a href="../injectables/CWLService.html" target="_self">CWLService</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="23" class="link-to-prism">src/mongoConnection/samples.service.ts:23</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>sampleModel</td>
                                                  
                                                        <td>
                                                                        <code><a href="../classes/Sample.html" target="_self" >Model&lt;SampleDocument&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>tasksQueueService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/TasksQueueService.html" target="_self" >TasksQueueService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>cwlService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/CWLService.html" target="_self" >CWLService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="checkSRRVariations"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>checkSRRVariations</b></span>
                        <a href="#checkSRRVariations"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>checkSRRVariations(downloadedName: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, savedName: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="155"
                            class="link-to-prism">src/mongoConnection/samples.service.ts:155</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>This is to hook up the logic that we have on the satellite with geo files and the way the file is renamed
 In theory this should be replaced later when we rewrite the GEO handling logic</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>downloadedName</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>name of file that was downloaded</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>savedName</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>name of file saved in database</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                    </div>
                    <div class="io-description">
                        <p>a check if they are equivalent</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="checkUpstreamOutputs"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>checkUpstreamOutputs</b></span>
                        <a href="#checkUpstreamOutputs"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>checkUpstreamOutputs(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="63"
                            class="link-to-prism">src/mongoConnection/samples.service.ts:63</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Check whether all of the upstreams of the given sample have been proccessed
 If the Upstream is missing outputs then it checks the actual upstream sample
 If the upstream sample has outputs then it copies the upstream over into the original sample
 If not it marks the sample as not ready</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>sample id</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                    </div>
                    <div class="io-description">
                        <p>whether the upstreams have finished analyzing</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="clearVisualPlugins"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>clearVisualPlugins</b></span>
                        <a href="#clearVisualPlugins"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>clearVisualPlugins(sampleId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="266"
                            class="link-to-prism">src/mongoConnection/samples.service.ts:266</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Updates a sample to clear the visual Plugin</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>sampleId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>Id of sample to clear</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getById"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>getById</b></span>
                        <a href="#getById"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getById(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="36"
                            class="link-to-prism">src/mongoConnection/samples.service.ts:36</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Get a sample from the database by ID</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>mongo id of the sample</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../classes/Sample.html" target="_self" >Promise&lt;SampleDocument&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="objectIsDirectory"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>objectIsDirectory</b></span>
                        <a href="#objectIsDirectory"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>objectIsDirectory(item: <a href="../interfaces/Output.html" target="_self">Output</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="368"
                            class="link-to-prism">src/mongoConnection/samples.service.ts:368</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>item</td>
                                    <td>
                                                <code><a href="../interfaces/Output.html" target="_self" >Output</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="objectIsFile"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>objectIsFile</b></span>
                        <a href="#objectIsFile"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>objectIsFile(item: <a href="../interfaces/Output.html" target="_self">Output</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="359"
                            class="link-to-prism">src/mongoConnection/samples.service.ts:359</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>item</td>
                                    <td>
                                                <code><a href="../interfaces/Output.html" target="_self" >Output</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateFileLocation"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateFileLocation</b></span>
                        <a href="#updateFileLocation"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateFileLocation(taskId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, fileId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, path: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, satId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, size: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="175"
                            class="link-to-prism">src/mongoConnection/samples.service.ts:175</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Update Sample Collection Location</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>taskId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>mongo id of task</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>fileId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>id of file to update</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>path</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>location of file on satellite</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>satId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>mongo id of satellite</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>size</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>file size</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../classes/Sample.html" target="_self" >Promise&lt;Sample&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateInputClass"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateInputClass</b></span>
                        <a href="#updateInputClass"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateInputClass(sample: <a href="../classes/Sample.html" target="_self">SampleDocument</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="126"
                            class="link-to-prism">src/mongoConnection/samples.service.ts:126</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Checks over the sample&#39;s inputs to make sure each one has a &#39;class&#39;
 if they don&#39;t have one, set it to &#39;File&#39;
 Then if any of them were changed update the samples collection</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>sample</td>
                                    <td>
                                                <code><a href="../classes/Sample.html" target="_self" >SampleDocument</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>The whole sample object</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../classes/Sample.html" target="_self" >Promise&lt;Sample&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateLocationsToRelative"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>updateLocationsToRelative</b></span>
                        <a href="#updateLocationsToRelative"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateLocationsToRelative(item: <a href="../interfaces/Output.html" target="_self">Output</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="381"
                            class="link-to-prism">src/mongoConnection/samples.service.ts:381</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>item</td>
                                    <td>
                                                <code><a href="../interfaces/Output.html" target="_self" >Output</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateOne"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span class="modifier">Async</span>
                        <span ><b>updateOne</b></span>
                        <a href="#updateOne"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateOne(_id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, updatedObject: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="46"
                            class="link-to-prism">src/mongoConnection/samples.service.ts:46</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Update one Sample by ID</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>_id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>id of the sample</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>updatedObject</td>
                                    <td>
                                                <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>object to update</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        <p>error or amount upserted (which is one)</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateOutputs"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateOutputs</b></span>
                        <a href="#updateOutputs"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateOutputs(report: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>, satId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="279"
                            class="link-to-prism">src/mongoConnection/samples.service.ts:279</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Update Outputs with Airflow report when completed</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>report</td>
                                    <td>
                                                <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>report from Airflow API</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>satId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>id of satellite</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updatePreview"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updatePreview</b></span>
                        <a href="#updatePreview"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updatePreview(_id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, visualPlugin: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="337"
                            class="link-to-prism">src/mongoConnection/samples.service.ts:337</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Update the preview visual plugin</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>_id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>sample to update</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>visualPlugin</td>
                                    <td>
                                                <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>Visual Plugin to use</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateProgress"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateProgress</b></span>
                        <a href="#updateProgress"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateProgress(report: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="235"
                            class="link-to-prism">src/mongoConnection/samples.service.ts:235</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Updates sample as Airflow works</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>report</td>
                                    <td>
                                                <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>report from Airflow API</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateStatistics"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateStatistics</b></span>
                        <a href="#updateStatistics"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateStatistics(_id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, statistics: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="351"
                            class="link-to-prism">src/mongoConnection/samples.service.ts:351</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Update sample with cwl airflow statistics</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>_id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>id of sample to update</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>statistics</td>
                                    <td>
                                                <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>statistics report from cwl airflow</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { forwardRef, Inject, Injectable } from &#x27;@nestjs/common&#x27;;
import { InjectModel } from &#x27;@nestjs/mongoose&#x27;;
import { Model } from &#x27;mongoose&#x27;;
import { WorkflowFactory } from &#x27;cwlts/models&#x27;;
import { safeLoad } from &#x27;js-yaml&#x27;;

import {
//     AirflowReportToAPI,
//     AirflowSuccessToAPI,
//     FileInformation,
//     SampleProgress,
//     Statistics,
//     VisualPlugin,
//     ErrorVisualPlugin,
    Output,
} from &#x27;../interfaces&#x27;;
import { Sample, SampleDocument } from &#x27;./schemas/sample.schema&#x27;;
import { TasksQueueService } from &#x27;./tasksQueue.service&#x27;;
import { CWLService } from &#x27;./cwl.service&#x27;;
import Log from &#x27;../lib/logger&#x27;;

@Injectable()
export class SamplesService {
    constructor(
        @InjectModel(Sample.name)
        private sampleModel: Model&lt;SampleDocument&gt;,
        @Inject(forwardRef(() &#x3D;&gt; TasksQueueService))
        private tasksQueueService: TasksQueueService,
        private cwlService: CWLService,
    ) {}

    /**
     * Get a sample from the database by ID
     * @param id mongo id of the sample
     */
    async getById(id: string): Promise&lt;SampleDocument&gt; {
        return this.sampleModel.findById(id).exec();
    }

    /**
     * Update one Sample by ID
     * @param _id id of the sample
     * @param updatedObject object to update
     * @returns error or amount upserted (which is one)
     */
    public async updateOne(_id: string, updatedObject: any) {
        try {
            const sat &#x3D; await this.sampleModel.updateOne({ _id }, { $set: updatedObject });
            return { upserted: sat.nModified };
        } catch (err) {
            return { err };
        }
    }

    /**
     * Check whether all of the upstreams of the given sample have been proccessed
     *  If the Upstream is missing outputs then it checks the actual upstream sample
     *  If the upstream sample has outputs then it copies the upstream over into the original sample
     *  If not it marks the sample as not ready
     * @param id sample id
     * @returns whether the upstreams have finished analyzing
     */
    async checkUpstreamOutputs(id: string): Promise&lt;boolean&gt; {
        Log.debug(&#x60;Sample ${id} is checking upstreams&#x60;);
        const sample &#x3D; await this.sampleModel.findById(id).exec();
        // If the Sample has no upstreams then we don&#x27;t need to look any further
        if (!sample.upstream) return true;
        // Get a list of all of the Upstream Keys and iterate over them
        const upstreamList &#x3D; Object.keys(sample.upstream);
        for (const key of upstreamList) {
            const upstream &#x3D; sample.upstream[key];
            // This is in a try/catch because if outputs don&#x27;t exist here then we want to check the upstream sample itself
            //  to see if it has been updated (We expect this to throw an error when the upstream isn&#x27;t ready)
            try {
                // If the upstream is an array of samples check each one
                if (Array.isArray(upstream)) {
                    if (upstream.some((i) &#x3D;&gt; Object.keys(i.outputs).length &lt; 1)) return false;
                } else {
                    if (Object.keys(upstream.outputs).length &lt; 1) return false;
                }
            } catch (err) {
                Log.debug(
                    &#x60;Error finding ${key} Upstream Outputs for ${
                        Array.isArray(upstream) ? upstream.map(({ _id }) &#x3D;&gt; _id).join(&#x27;,&#x27;) : upstream._id
                    } in current sample, check to see if they exist yet&#x60;,
                );
                Log.debug(&#x60;Probably not actually an error: ${err}&#x60;);

                // If the upstream is an array replace all of the samples in it with updated upstreams
                if (Array.isArray(upstream)) {
                    const updatedArr &#x3D; [];
                    for (const { _id } of upstream) {
                        Log.debug(&#x60;Getting updated ${key} upstream ${_id} for Sample ${id}&#x60;);
                        const updatedUpstream &#x3D; await this.sampleModel.findById(_id).exec();
                        // If any of them aren&#x27;t finished dont update any of them
                        if (!updatedUpstream.outputs) return false;
                        updatedArr.push(updatedUpstream);
                    }
                    sample.upstream[key] &#x3D; updatedArr;
                } else {
                    // Check to see if the upstream sample has any outputs
                    const upSample &#x3D; await this.sampleModel.findById(upstream._id).exec();
                    // If it doesn&#x27;t the sample isn&#x27;t ready to be processed
                    if (!upSample.outputs) return false;
                    sample.upstream[key] &#x3D; upSample;
                }

                // If the sample has been updated with finished upstreams then update it in the DB
                try {
                    await this.sampleModel.updateOne({ _id: id }, sample);
                } catch (err) {
                    Log.error(&#x60;Failed to update upstreams for ${id}: ${err}&#x60;);
                }
            }
        }
        Log.debug(&#x60;Sample ${id} is ready&#x60;);
        return true;
    }

    /**
     * Checks over the sample&#x27;s inputs to make sure each one has a &#x27;class&#x27;
     *  if they don&#x27;t have one, set it to &#x27;File&#x27;
     *  Then if any of them were changed update the samples collection
     * @param sample The whole sample object
     */
    async updateInputClass(sample: SampleDocument): Promise&lt;Sample&gt; {
        let changed &#x3D; false;
        const updatedInputs &#x3D; {};
        Object.keys(sample.inputs).forEach((key) &#x3D;&gt; {
            const updatedItem &#x3D; sample.inputs[key];
            try {
                if (!!updatedItem.token) {
                    updatedItem[&#x27;class&#x27;] &#x3D; &#x27;File&#x27;;
                    changed &#x3D; true;
                }
            } finally {
                updatedInputs[key] &#x3D; updatedItem;
            }
        });
        if (changed) {
            await this.sampleModel.findOneAndUpdate({ _id: sample._id }, { $set: { inputs: updatedInputs } }, { useFindAndModify: false });
            const updated &#x3D; sample.toObject();
            return { ...updated, inputs: updatedInputs };
        }
        return sample;
    }

    /**
     * This is to hook up the logic that we have on the satellite with geo files and the way the file is renamed
     *  In theory this should be replaced later when we rewrite the GEO handling logic
     * @param downloadedName name of file that was downloaded
     * @param savedName name of file saved in database
     * @returns a check if they are equivalent
     */
    private checkSRRVariations(downloadedName: string, savedName: string): boolean {
        const lcDownloadedName &#x3D; downloadedName.toLowerCase();
        const lcSavedName &#x3D; savedName.toLowerCase();
        if (lcDownloadedName &#x3D;&#x3D; lcSavedName) {
            return true;
        }
        if (lcDownloadedName.replace(&#x27;,&#x27;, &#x27;_&#x27;) &#x3D;&#x3D; lcSavedName) {
            return true;
        }
        return false;
    }

    /**
     * Update Sample Collection Location
     * @param taskId mongo id of task
     * @param fileId id of file to update
     * @param path location of file on satellite
     * @param satId mongo id of satellite
     * @param size file size
     */
    async updateFileLocation(taskId: string, fileId: string, path: string, satId: string, size: number): Promise&lt;Sample&gt; {
        try {
            const task &#x3D; await this.tasksQueueService.getById(taskId, satId);
            const downloads &#x3D; task.payload.get(&#x27;downloads&#x27;);
            const download &#x3D; { ...downloads[fileId] };
            // const download &#x3D; task.payload.get(&#x27;downloads&#x27;).filter((item) &#x3D;&gt; item.fileId &#x3D;&#x3D;&#x3D; fileId)[0];
            if (!this.checkSRRVariations(download.fileName.split(&#x27;.&#x27;)[0], path.split(&#x27;/&#x27;).pop().split(&#x27;.&#x27;)[0])) {
                throw Error(&#x27;File names do not match&#x27;);
            }
            // const fileInformation: FileInformation &#x3D; {
            const fileInformation: any &#x3D; {
                originalName: download.originalName,
                size,
            };
            const updatedFile &#x3D; {
                class: &#x27;File&#x27;,
                location: &#x60;file://${path}&#x60;,
                fileInformation,
            };
            const href: string &#x3D; download.fileUrl?.href;
            if (href.includes(&#x27;geo&#x27;)) {
                const updateList: string[] &#x3D; [];
                const sample &#x3D; await this.sampleModel.findOne({ _id: download.sampleId });
                for (const key in sample.inputs) {
                    const input &#x3D; sample.inputs[key];
                    try {
                        if (input.location.toLowerCase() !&#x3D;&#x3D; href.toLowerCase()) continue;
                        updateList.push(&#x60;inputs.${key}&#x60;);
                    } catch (err) {
                        Log.debug(&#x60;Failed to compare ${input.location}: ${err}&#x60;);
                        continue;
                    }
                }
                const secondFile &#x3D; {
                    class: &#x27;File&#x27;,
                    location: &#x60;file://${path.replace(&#x27;.fastq&#x27;, &#x27;_2.fastq&#x27;)}&#x60;,
                    fileInformation,
                };
                return await this.sampleModel.findOneAndUpdate(
                    { _id: download.sampleId },
                    {
                        $set: {
                            [updateList[0]]: updatedFile,
                            [updateList[1]]: secondFile,
                        },
                    },
                );
            }
            // sample.inputs[download.inputKey] &#x3D; updatedFile;
            const toUpdate &#x3D; &#x60;inputs.${download.inputKey}&#x60;;
            return await this.sampleModel.findOneAndUpdate({ _id: download.sampleId }, { $set: { [toUpdate]: updatedFile } }, { useFindAndModify: false });
        } catch (err) {
            throw Error(err);
        }
    }

    /**
     * Updates sample as Airflow works
     * @param report report from Airflow API
     */
    async updateProgress(report: any) {
    // async updateProgress(report: AirflowReportToAPI) {
        try {
            // let progress: SampleProgress;
            let progress: any;
            if (report.error) {
                progress &#x3D; {
                    error: report.error,
                    progress: Math.min(report.progress, 100),
                    title: &#x27;Error&#x27;,
                };
            } else {
                progress &#x3D; {
                    progress: Math.min(report.progress, 100),
                    title: report.state,
                };
            }
            return this.sampleModel.findOneAndUpdate(
                { _id: report.runId },
                { $set: { &#x27;preview.visualPlugins&#x27;: [{ progress }] } },
                { useFindAndModify: false },
            );
        } catch (err) {
            throw err;
        }
    }

    /**
     * Updates a sample to clear the visual Plugin
     * @param sampleId Id of sample to clear
     */
    async clearVisualPlugins(sampleId: string) {
        try {
            return this.sampleModel.findOneAndUpdate({ _id: sampleId }, { $set: { &#x27;preview.visualPlugins&#x27;: [] } }, { useFindAndModify: false });
        } catch (err) {
            throw err;
        }
    }

    /**
     * Update Outputs with Airflow report when completed
     * @param report report from Airflow API
     * @param satId id of satellite
     */
    async updateOutputs(report: any, satId: string) {
    // async updateOutputs(report: AirflowSuccessToAPI, satId: string) {
        try {
            const sample &#x3D; await this.sampleModel.findById(report.runId).exec();
            if (sample.satellite_id !&#x3D;&#x3D; satId) {
                throw new Error(&#x27;Trying to access incorrect Satellite&#x27;);
            }
            const cwl &#x3D; await this.cwlService.getById((await sample).cwlId);
            const cwlJson &#x3D; safeLoad(cwl.source.source) as any;
            const cwlModel &#x3D; WorkflowFactory.from(cwlJson, &#x27;document&#x27;);
            const updatedOutputs &#x3D; {};
            cwlModel.outputs.forEach((output) &#x3D;&gt; {
                const result &#x3D; this.updateLocationsToRelative(report.results[output.id]);
                console.log(result);
                if (output.type.type &#x3D;&#x3D;&#x3D; &#x27;File&#x27;) {
                    if (this.objectIsFile(result)) {
                        updatedOutputs[output.id] &#x3D; result;
                        return;
                    }
                } else if (output.type.type &#x3D;&#x3D;&#x3D; &#x27;Directory&#x27;) {
                    if (this.objectIsDirectory(result)) {
                        updatedOutputs[output.id] &#x3D; result;
                        return;
                    }
                } else if (output.type.type &#x3D;&#x3D;&#x3D; &#x27;array&#x27;) {
                    if (Array.isArray(result) &amp;&amp; result.every((item) &#x3D;&gt; this.objectIsFile(item))) {
                        updatedOutputs[output.id] &#x3D; result;
                        return;
                    }
                } else {
                    if ((output.type.type &#x3D;&#x3D;&#x3D; &#x27;int&#x27; || output.type.type &#x3D;&#x3D;&#x3D; &#x27;float&#x27;) &amp;&amp; typeof result &#x3D;&#x3D;&#x3D; &#x27;number&#x27;) {
                        updatedOutputs[output.id] &#x3D; result;
                        return;
                    }
                    if (output.type.type &#x3D;&#x3D;&#x3D; &#x27;string&#x27; &amp;&amp; typeof result &#x3D;&#x3D;&#x3D; &#x27;string&#x27;) {
                        updatedOutputs[output.id] &#x3D; result;
                        return;
                    }
                    if (output.type.type &#x3D;&#x3D;&#x3D; &#x27;boolean&#x27; &amp;&amp; typeof result &#x3D;&#x3D;&#x3D; &#x27;boolean&#x27;) {
                        updatedOutputs[output.id] &#x3D; result;
                        return;
                    }
                }
                Log.debug(&#x60;Invalid ${output.id} into Outputs: ${result}&#x60;);
                updatedOutputs[output.id] &#x3D; null;
            });
            return this.sampleModel.findOneAndUpdate({ _id: report.runId }, { $set: { outputs: updatedOutputs } }, { useFindAndModify: false });
        } catch (err) {
            throw err;
        }
    }

    /**
     * Update the preview visual plugin
     * @param _id sample to update
     * @param visualPlugin Visual Plugin to use
     */
    // async updatePreview(_id: string, visualPlugin: VisualPlugin | ErrorVisualPlugin) {
    async updatePreview(_id: string, visualPlugin: any) {
        try {
            return this.sampleModel.findOneAndUpdate({ _id }, { $set: { &#x27;preview.visualPlugins&#x27;: [visualPlugin] } }, { useFindAndModify: false });
        } catch (err) {
            throw err;
        }
    }

    /**
     * Update sample with cwl airflow statistics
     * @param _id id of sample to update
     * @param statistics statistics report from cwl airflow
     */
    // async updateStatistics(_id: string, statistics: Statistics) {
    async updateStatistics(_id: string, statistics: any) {
        try {
            return this.sampleModel.findOneAndUpdate({ _id }, { $set: { statistics } }, { useFindAndModify: false });
        } catch (err) {
            throw err;
        }
    }

    private objectIsFile(item: Output): boolean {
        if (!item) return false;
        if (typeof item.location !&#x3D;&#x3D; &#x27;string&#x27;) return false;
        if (typeof item.basename !&#x3D;&#x3D; &#x27;string&#x27;) return false;
        if (typeof item.size !&#x3D;&#x3D; &#x27;number&#x27;) return false;
        if (item.class !&#x3D;&#x3D; &#x27;File&#x27;) return false;
        return true;
    }

    private objectIsDirectory(item: Output): boolean {
        if (!item) return false;
        if (typeof item.location !&#x3D;&#x3D; &#x27;string&#x27;) return false;
        if (typeof item.basename !&#x3D;&#x3D; &#x27;string&#x27;) return false;
        if (item.class !&#x3D;&#x3D; &#x27;Directory&#x27;) return false;
        return item.listing.every((item) &#x3D;&gt; {
            if (item.class &#x3D;&#x3D;&#x3D; &#x27;File&#x27;) {
                return this.objectIsFile(item);
            }
            return this.objectIsDirectory(item);
        });
    }

    private updateLocationsToRelative(item: Output): any {
        if (!item) return item;
        if (Array.isArray(item)) {
            return item.map((i) &#x3D;&gt; this.updateLocationsToRelative(i));
        }
        if (!item.location) {
            return item;
        }
        const updatedItem &#x3D; { ...item };
        if (!!updatedItem.secondaryFiles) {
            updatedItem.secondaryFiles &#x3D; updatedItem.secondaryFiles.map((i) &#x3D;&gt; this.updateLocationsToRelative(i));
        }
        if (!!updatedItem.listing) {
            updatedItem.listing &#x3D; updatedItem.listing.map((i) &#x3D;&gt; this.updateLocationsToRelative(i));
        }
        const updatedLocation &#x3D; &#x27;file://projects&#x27; + item.location.split(&#x27;projects&#x27;).pop();
        updatedItem.location &#x3D; updatedLocation;
        return updatedItem;
    }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'SamplesService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
